function loadMyLastIng(){$.get("/ajax/ing/MyLastIng","",function(n){$("#ing_current").html(n)},"text")}function GetIngComments(n,t,i){$.ajax({url:"http://ing.cnblogs.com/ajax/ing/GetSingleIngComments?ingId="+n+"&userAlias="+t,type:"get",dataType:"jsonp",success:function(t){i&&(t='<div class="ing_comments">'+t+"<\/div>");$("#ing_comment_l_b_"+n).html(t)}})}function GetIngRecentComments(n,t,i,r){GetIngComments(n,t,r)}function showIngUserInfo(){$.ajax({url:"/ajax/user/CurrentIngUserInfo",dataType:"json",success:function(n){n.Avatar&&$("#ing_current_avatar").html(n.Avatar);n.Username&&$("#ing_current_username").html(n.Username)}})}function publish_ing(){publish_ing_new()}function publish_ing_new(){var n=$("#txt_ing").val(),r,t,i;n=$.trim(n);try{if(r=n.replace(/(http|ftp|https):\/\/([^\/:,，]+)(:\d+)?(\/[^\u0391-\uFFE5\s,]*)?/ig,"").replace(/(\s)+/ig,""),r.length>300){alert("闪存内容不能超过300个字符！当前字符数: "+r.length);return}}catch(u){}if(n==""){$("#txt_ing").attr("placeholder","提示：请输入内容");window.setTimeout(function(){n=$("#txt_ing").val();n=$.trim(n);n==""&&$("#txt_ing").attr("placeholder",DEFAULT_ING_TIPS)},2e3);return}show_ing_tip("　发布中..");$("#btn_ing_publish").attr("disabled","true");t=1;($("#ing_type_private").attr("checked")=="checked"||$("#ing_type_private").attr("checked")==!0)&&(t=0);i={};i.content=n;i.publicFlag=t;$.ajax({timeout:3e4,url:"/ajax/ing/Publish",data:JSON.stringify(i),type:"post",dataType:"json",contentType:"application/json; charset=utf-8",success:function(n){n.IsSuccess?location.href=t==0?"http://ing.cnblogs.com/#my":"http://ing.cnblogs.com/":(show_ing_tip(n.responseText),$("#btn_ing_publish").removeAttr("disabled"))},error:function(n,t){var i;i=n.status==500?"抱歉！发生了错误！麻烦反馈至contact@cnblogs.com":n.status>0?"抱歉！提交失败！错误信息："+n.responseText:"抱歉！提交失败！出错原因："+t;show_ing_tip(i);$("#last_ing").html("");$("#btn_ing_publish").removeAttr("disabled")}})}function PublicIngEnterNew(n){if(n.keyCode==13)return publish_ing_new(),!1}function SetIngTag(n){return HideTip(),$("#txt_ing").val("["+n+"]"+$("#txt_ing").val()),$("#txt_ing").selectRange(1,n.length+1),!1}function show_ing_tip(n){$("#ing_publish_tip").html(n)}function commentReply(n,t,i,r){showCommentBox(n,i,r);currentParentCommentId=t;var u=$("#comment_input");u.val("@"+htmlDecode($("#comment_author_"+t).html())+"："+u.val())}function showCommentBox(n,t,i){if($("#feed_list .comment-box").each(function(){$(this).remove()}),typeof i=="undefined"&&(i=n),currentIngId=n,replyToSpaceUserId=t,currentParentCommentId=0,isLogined){isReplyBoxShown=!0;var r=$("#panel_"+i);r.length&&(r.html("<div class='comment-box'><input class='long_input' onkeydown='ctrlEnter("+i+",event)' id='comment_input'/><input type='button' onclick='insertComment("+i+");return false;' class='submit_btn_self' id='comment_btn' title='直接Enter可以提交' value='提交'/> 或 <a onclick='hideCommentBox(this);return false;' href='#' class='gray2'>取消<\/a><\/div>"),r.show());$("#comment_input").select().focus()}else location.href="http://passport.cnblogs.com/Login.aspx?ReturnURL="+location.href}function hideCommentBox(n){isReplyBoxShown=!1;var t=$(n).parent();t.parent().hide();t.remove()}function ctrlEnter(n,t){if(t.keyCode==13)return insertComment(n),!1}function insertComment(n){var i=200,t={};if(t.ContentId=currentIngId,t.ContentId==0&&(t.ContentId=n),t.ReplyTo=replyToSpaceUserId,t.ParentCommentId=currentParentCommentId,t.Content=$.trim($("#comment_input").val()),t.Content=="")return alert("回复内容不能为空!"),!1;if(t.Content.length>i)return alert("回复内容不能超过"+i+"个字符！当前字符数: "+t.Content.length),!1;if(isPostingComment){alert("上次提交未完成...");return}isPostingComment=!0;$("#comment_btn").attr("disabled","true").attr("value","提交中...");$.ajax({timeout:3e4,url:"/ajax/ing/PostComment",data:JSON.stringify(t),type:"post",dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(t){t.IsSuccess?($("#comment_block_"+n).append(t.Message),$("#comment_input").val(""),$("#panel_"+n).length&&hideCommentBox($("#comment_btn"))):alert(t.Message);resetCommentBox();isPostingComment=!1}).fail(function(n,t){var i;i=n.status==500?"抱歉！发生了错误！麻烦反馈至contact@cnblogs.com":n.status>0?"抱歉！提交失败！错误信息："+n.responseText:"抱歉！提交失败！出错原因："+t;$("#comment_btn").removeAttr("disabled");isPostingComment=!1;resetCommentBox();alert(i)})}function resetCommentBox(){$("#comment_btn").removeAttr("disabled").attr("value","提交")}function DeleteComment(n){var t=confirm("你确实要删除这条评论吗？");t==!0&&$.ajax({url:"/ajax/ing/DeleteComment",data:'{"commentId":'+n+"}",type:"post",dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){$("#comment_"+n).html(t.Message)},error:function(t){$("#comment_"+n).html(t.responseText)}})}var isShowLoading=!0,replyToSpaceUserId=0,currentParentCommentId=0,currentIngId=0,isPostingComment=!1,isReplyBoxShown=!1,currentPageIndex=1,pageSize=30;$.fn.selectRange=function(n,t){return this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})}
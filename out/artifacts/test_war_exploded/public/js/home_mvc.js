function loadCurrentUserInfo(){$.ajax({url:"/user/CurrentUserInfo",type:"get",dataType:"text",success:function(n){var t=$("#header_user");t.html()!=n&&$("#header_user").html(n)}})}function htmlDecode(n){return $("<div/>").html(n).text()}function htmlEncode(n){var t=$("<div/>").text(n).html();return t.replace(/['"]/g,"&quot;")}function SearchUser(){if($("#txt_user_name").val()==""||$("#txt_user_name").val()=="先输入内容")$("#txt_user_name").val("先输入内容"),$("#txt_user_name").css("color","gray"),window.setTimeout(function(){$("#txt_user_name").val()=="先输入内容"&&($("#txt_user_name").val(""),$("#txt_user_name").css("color","#000"))},1e3);else{var n=encodeURIComponent($("#txt_user_name").val());window.location="/user/Search.aspx?key="+n}}function SearchUserEnter(n){if(n.keyCode==13)return SearchUser(),!1}function zzk_go(){var n=encodeURIComponent(document.getElementById("q").value);window.location="http://zzk.cnblogs.com/s?w="+n}function zzk_go_enter(n){if(n.keyCode==13)return zzk_go(),!1}function CheckMsg(){var n=$("#msg_count"),t;$("#msg_count").length&&(t=$.ajax({url:"/ajax/user/GetUnreadMsgCount",type:"get",dataType:"text",success:function(t){t!=="0"?n!="["+t+"]"&&n.html("["+t+"]"):n.html()!=""&&$("#msg_count").html("")}}))}function GetPassportHost(){return"http://"+location.hostname.replace("home.","passport.")+"/"}function logout_immediate(){return location.href=GetPassportHost()+"logout.aspx?ReturnUrl="+location.href,!1}function setFeedTab(n){return isLogined?($(".topic_nav_block a").removeClass("current_nav"),$(".topic_nav_block #feed_"+n).addClass("current_nav"),n=="me"?(feedListType=4,ToggleGroupDiv(!1)):n=="all"?(feedListType=5,ToggleGroupDiv(!1)):(feedListType=1,ToggleGroupDiv(!0)),$("#sel_application").val("all"),currentAppId="",GetPagedFeed(1),!1):(login(),!1)}function ToggleGroupDiv(n){n?$(".group_list").show():$(".group_list").hide()}function RefreshFeed(){$("#sel_application").val("all");currentAppId="";$("#refresh_tips").html("更新中...");$("#a_refresh").hide();var n=GetCurrentGroupId();return n!=null?(GetPagedFeedByGroup(n,1,30),!1):(GetPagedFeed(1),!1)}function GetCurrentGroupId(){if($(".group_list").css("display")=="block"){var n=$(".group_list li.active");if(n.text()!="全部")return n.attr("id")}return null}function GetPagedFeed(n,t){return window.scrollTo(0,0),pageSize=t,GetPagedFeed(n),!1}function GetPagedFeed(n){ShowLoading();currentAppId==""&&(currentAppId="00000000-0000-0000-0000-000000000000");var t=(new Date).getTime();return $.ajax({url:"/ajax/feed/recent",data:'{"feedListType":'+feedListType+',"appId":"'+currentAppId+'","pageIndex":'+n+',"pageSize":'+pageSize+"}",type:"post",dataType:"text",contentType:"application/json;",cache:!1,success:function(n){ShowProfiler((new Date).getTime()-t);$("#a_refresh").show();$("#refresh_tips").html("");HideLoading();n?$("#feed_list").html(n):$("#feed_list").html("<li class='nofeed'>当前无动态 :-)<\/li>")},error:function(){HideLoading()}}),$.ajax({url:"/ajax/feed/GetFeedPager",data:'{"feedListType":'+feedListType+',"appId":"'+currentAppId+'","pageIndex":'+n+',"pageSize":'+pageSize+"}",type:"post",dataType:"text",contentType:"application/json;",cache:!1,success:function(t){$("#feed_pager_block").html(t);n>1?($("#pager_top").html(t),$("#pager_top").show()):$("#pager_top").hide()},error:function(){}}),!1}function GetPagedFeedByGroup(n,t,i){return window.scroll(0,0),pageSize=i,getPagedFeedByGroup(t,n),!1}function getPagedFeedByGroup(n,t){ShowLoading();currentAppId==""&&(currentAppId="00000000-0000-0000-0000-000000000000");var i={feedListType:"1",appId:currentAppId,pageIndex:n,pageSize:pageSize,groupId:t},r=(new Date).getTime();return $.ajax({url:"/ajax/feed/recentByGroup",data:JSON.stringify(i),type:"post",dataType:"text",contentType:"application/json;",cache:!1,success:function(n){ShowProfiler((new Date).getTime()-r);$("#a_refresh").show();$("#refresh_tips").html("");HideLoading();n?$("#feed_list").html(n):$("#feed_list").html("<li class='nofeed'>当前无动态 :-)<\/li>")},complete:function(){HideLoading()}}),$.ajax({url:"/ajax/feed/GetFeedPagerByGroup",data:JSON.stringify({feedListType:feedListType,appId:currentAppId,pageIndex:n,pageSize:pageSize,groupId:t}),type:"post",dataType:"text",contentType:"application/json;",cache:!1,success:function(t){$("#feed_pager_block").html(t);n>1?($("#pager_top").html(t),$("#pager_top").show()):$("#pager_top").hide()},error:function(){}}),!1}function GetFeedsBySelect(n){var i="00000000-0000-0000-0000-000000000000",t;$.ajax({url:"/ajax/common/GetApplicationIdByName",data:'{applicatonName:"'+n+'"}',type:"post",dataType:"text",contentType:"application/json;charset=utf-8",cache:!1,async:!1,success:function(n){i=n}});currentAppId=i;t=GetCurrentGroupId();t==null?GetPagedFeed(1):GetPagedFeedByGroup(t,1,30)}function DeleteFeed(n,t,i,r){var u=confirm("你确实要删除这个动态吗？");return u==!0&&$.ajax({url:"/ajax/feed/DeleteFeed",data:'{"feedType":"'+n+'","contentId":'+t+',"userDisplayName":"'+i+'","isAdmin":"'+r+'"}',type:"post",dataType:"JSON",contentType:"application/json;charset=utf-8",success:function(n){n.IsSuccess&&($("#feed_content_"+t).css("color","red"),$("#feed_content_"+t).html("删除成功"))}}),!1}function SetPageUrl(n){var t="";switch(feedTypeIndex){case 1:t="recent/";break;case 4:t="me/";break;case 5:t="all/";break;default:t="recent/"}pageUrl=n==""?"/new/feed/"+t+"{0}.html":"/new/feed/"+t+n+"/{0}.html"}function SetFeedRefreshStaus(){var n=$("#feed_list").height();$("#feed_list").html('<li class="feed_loading" id="feed_loading_block"><img src="http://static.cnblogs.com/images/loading.gif" alt=""/><\/li>');$("#feed_loading_block").css("height",n)}function HideTip(){($("#txt_ing").val()==DEFAULT_ING_TIPS||$("#txt_ing").val()=="提示：请输入内容")&&($("#txt_ing").val(""),$("#txt_ing").css("color","#222"),$("#txt_ing").css("font-size","14px"))}function IngIsEmpty(){$("#txt_ing").val()==""&&($("#txt_ing").css("color","#BBB"),$("#txt_ing").val(DEFAULT_ING_TIPS))}function cnblogs_code_collapse(n){n.children("div.cnblogs_code_open").css("display")!="none"?(n.children("div.cnblogs_code_open").css("display","none"),n.children("img.code_img_opened").css("display","none"),n.children("img.code_img_closed").css("display","inline")):(n.children("div.cnblogs_code_open").css("display","block"),n.children("img.code_img_opened").css("display","inline"),n.children("img.code_img_closed").css("display","none"))}function cnblogs_code_show(n){$("#cnblogs_code_open_"+n).css("display")=="none"&&($("#cnblogs_code_open_"+n).show(),$("#code_img_opened_"+n).show(),$("#code_img_closed_"+n).hide())}function cnblogs_code_hide(n,t){$("#cnblogs_code_open_"+n).css("display")!="none"&&($("#cnblogs_code_open_"+n).hide(),$("#code_img_opened_"+n).hide(),$("#code_img_closed_"+n).show(),t.stopPropagation())}function AddToWz(){window.open("http://wz.cnblogs.com/create?t=&u=&c=&i=0","_blank","scrollbars=auto,width=460,height=353,left=100,top=50,status=yes,resizable=yes")}function PutInWz(){var i=460,r=353,u=(screen.width-i)/2,f=(screen.height-r)/2,n=document,t=n.selection?n.selection.type!="None"?n.selection.createRange().text:"":n.getSelection?n.getSelection():"";t.length>200&&(t=t.substring(0,200));window.open("http://wz.cnblogs.com/create?t="+escape(n.title)+"&u="+encodeURIComponent(n.location.href)+"&c="+escape(t)+"&i=0","_blank","width="+i+",height="+r+",toolbars=0,resizable=1,left="+u+",top="+f)}function ShowLoading(){$("#feed_loading").html('<img align="absmiddle" src="http://static.cnblogs.com/images/loading.gif" alt=""/> 正在加载数据...');$("#feed_loading").show();$("#feed_list").hide()}function HideLoading(){$("#feed_loading").hide();$("#feed_list").show()}function ShowProfiler(n){$("#profiler_footer").html("(执行耗时"+n+"毫秒)")}function RelationController(){}function gotoTop(){return window.scrollTo(0,0),!1}function followByGroup(n,t){var i=dialog({width:480,height:n?450:420,title:"关注成功",data:{name:currentUserName,currentUserId:currentUserId,remark:t,enableSetRemark:n},url:"/follow_group/Index/?enableSetRemark="+n,onclose:function(){var r=dialog({content:"保存成功！"}),t,i;if(!this.returnValue.IsSucceed){n&&($("#li_groupList").hide(),$("#groupList").html(""));return}if(!this.returnValue.isCancel){for(n&&this.returnValue.Remark&&($("#li_remark").show(),$("#remarkId").html(this.returnValue.Remark)),$("#groupList").html(""),t=this.returnValue.UserRelationGroups.length,t<=0?$("#li_groupList").hide():$("#li_groupList").show();t>0;)i=this.returnValue.UserRelationGroups[t-1],$("#groupList").append($('<li><a href="/followees/'+i.id+'">'+i.groupName+"<\/a><\/li>")),t--;r.show();setTimeout(function(){r.close().remove()},2e3)}}});i.showModal()}function follow(){$("#link_follow").hide();$("#follow_block_info").html("<span class='text_gray'>正在处理中...<\/span>");var n=currentUserId;$.ajax({url:"/ajax/follow/FollowUser",data:'{userId:"'+n+'",remark:""}',type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.IsSucceed?($("#followedPanel").show(),$("#unFollowedPanel").hide(),$("#follow_block_info").html("关注成功"),$("#follower_count").html(parseInt($("#follower_count").html())+1),followByGroup(!0,"")):(alert("添加关注失败，请联系管理员。"),$("#link_follow").show(),$("#follow_block_info").html(""))},error:function(){alert("添加关注失败，请联系管理员。");$("#link_follow").show();$("#follow_block_info").html("")}})}function SetRemark(n){var t=dialog({title:"提示（可为空）",content:"备注名称：<input id='remarkTxt' value='"+n+"' autofocus />",okValue:"确定",ok:function(){var n=$("#remarkTxt").val().trim(),t;$("#link_follow").hide();$("#follow_block_info").html("<span class='text_gray'>正在处理中...<\/span>");t=currentUserId;$.ajax({url:"/ajax/follow/SetRemark",data:'{userId:"'+t+'",remark:"'+n+'"}',type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(t){t.IsSucceed?(n.length>0?($("#li_remark").show(),$("#remarkId").html(n)):$("#li_remark").hide(),$("#follow_block_info").html("设置备注名称成功")):(alert("添加关注失败，请联系管理员。"),$("#link_follow").show(),$("#follow_block_info").html(""))},error:function(){alert("添加关注失败，请联系管理员。");$("#link_follow").show();$("#follow_block_info").html("")}})},cancelValue:"取消",cancel:function(){}});t.show()}function RemoveFollow(){var n=dialog({title:"取消",content:"您确定要取消关注吗？",okValue:"确定",ok:function(){$("#follow_block_info").html("<span class='text_gray'>正在处理中...<\/span>");var n=currentUserId,t=$("#groupRange").length>0;$.ajax({url:"/ajax/follow/RemoveFollow",data:JSON.stringify({userId:n,isRemoveGroup:t}),type:"post",dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(n){n.IsSucceed?($("#followedPanel").hide(),$("#unFollowedPanel").show(),$("#li_remark").hide(),$("#follow_block_info").html("成功取消关注"),$("#follower_count").html(parseInt($("#follower_count").html())-1)):$("#follow_block_info").html("<p>取消关注失败，请联系管理员<\/p>")},error:function(){$("#follow_block_info").html("<p>取消关注失败，请联系管理员<\/p>")}})},cancelValue:"取消",cancel:function(){}});n.showModal()}var ajaxRequest={},Pager;ajaxRequest.type="post";ajaxRequest.dataType="json";ajaxRequest.contentType="application/json; charset=utf8";ajaxRequest.data="{}";$.ajaxSetup({type:"post",dataType:"json",contentType:"application/json; charset=utf8",cache:!1});var DEFAULT_ING_TIPS="你在做什么？你在想什么？",search=function(){},searchEnter=function(n){if(n.keyCode==13)return search(),!1};$(document).ready(function(){$(".group_list").on("click","li>a",function(){$(".group_list li.active").removeClass("active");$(this).parent().addClass("active")})});Pager={};Pager.PageIndex=1;Pager.PageSize=30;Pager.ShowPageCount=5;Pager.TotalCount=0;Pager.UrlFormat=location.href+"?page={0}";Pager.ClickFunctionName="";Pager.Build=function(n){var t,e;this.PageSize>=this.TotalCount;$(n).html("");var r=parseInt((this.TotalCount+this.PageSize-1)/this.PageSize),u=this.PageIndex-this.ShowPageCount,f=this.PageIndex+this.ShowPageCount;for(r>this.ShowPageCount*2-1?u<1?(u=1,f=u+2*this.ShowPageCount):f>r&&(u=r-2*this.ShowPageCount,f=r):(u=1,f=r),t=document.createDocumentFragment(),this.PageIndex>1&&(t.appendChild(this.BuildLink("&lt; Prev",this.PageIndex-1)),this.PageIndex>this.ShowPageCount+1&&u>1&&t.appendChild(this.BuildLink(1,1)),u>2&&t.appendChild(document.createTextNode("···"))),i=u;i<=f;i++)i==this.PageIndex?(e=document.createElement("span"),$(e).prop("class","current"),e.innerHTML=this.PageIndex,t.appendChild(e)):t.appendChild(this.BuildLink(i,i));this.PageIndex<r&&(f<r&&(t.appendChild(document.createTextNode("···")),t.appendChild(this.BuildLink(r,r,this.TotalCount))),t.appendChild(this.BuildLink("Next &gt;",this.PageIndex+1,this.TotalCount)));$(n).html(t)};Pager.BuildLink=function(n,t){var i=document.createElement("a"),r;return this.ClickFunctionName?(i.href="javascript:void(0);",r=this.ClickFunctionName+"("+t+");Pager.SetCurrent("+t+");",i.onclick=function(){eval(r)}):i.href=this.UrlFormat.replace("{0}",t),i.innerHTML=n,i};Pager.SetCurrent=function(n){this.PageIndex=n;this.PageIndex>1&&this.Build($("#pager_top"));this.Build($("#pager_bottom"))};RelationController.GetMyFolloweesFollowers=function(n,t){$.ajax({url:"/Relation/GetMyFolloweesFollowers",data:'{"id":'+n+"}",type:"post",dataType:"text",success:function(n){$("#"+t).html(n)}})};typeof googletag!="undefined"&&googletag.cmd.push(function(){googletag.defineSlot("/1090369/home.cnblogs.com_side",[250,250],"div-gpt-ad-1346371457607-0").addService(googletag.pubads());googletag.pubads().enableSingleRequest();googletag.enableServices()});$(function(){CheckMsg()})